<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>跟上Java8 - Stream API快速入门 | 王爵的技术博客 | 一个后端程序员的笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Java8,stream,flatmap,filter,collect">
    <meta name="description" content="在前面我们简单介绍了lambda表达式，Java8旨在帮助程序员写出更好的代码， 其对核心类库的改进也是关键的一部分，Stream是Java8种处理集合的抽象概念， 它可以指定你希望对集合的操作，但是执行操作的时间交给具体实现来决定。">
<meta name="keywords" content="Java8,stream,flatmap,filter,collect">
<meta property="og:type" content="article">
<meta property="og:title" content="跟上Java8 - Stream API快速入门">
<meta property="og:url" content="http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html">
<meta property="og:site_name" content="王爵的技术博客">
<meta property="og:description" content="在前面我们简单介绍了lambda表达式，Java8旨在帮助程序员写出更好的代码， 其对核心类库的改进也是关键的一部分，Stream是Java8种处理集合的抽象概念， 它可以指定你希望对集合的操作，但是执行操作的时间交给具体实现来决定。">
<meta property="og:image" content="http://biezhi.me/static/img/article/java8-stream-class.png">
<meta property="og:image" content="http://biezhi.me/static/img/article/java8-filter.png">
<meta property="og:image" content="http://biezhi.me/static/img/article/java8-map.png">
<meta property="og:image" content="http://biezhi.me/static/img/article/java8-flatmap.png">
<meta property="og:updated_time" content="2017-07-19T11:46:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="跟上Java8 - Stream API快速入门">
<meta name="twitter:description" content="在前面我们简单介绍了lambda表达式，Java8旨在帮助程序员写出更好的代码， 其对核心类库的改进也是关键的一部分，Stream是Java8种处理集合的抽象概念， 它可以指定你希望对集合的操作，但是执行操作的时间交给具体实现来决定。">
<meta name="twitter:image" content="http://biezhi.me/static/img/article/java8-stream-class.png">
    
        <link rel="alternate" type="application/atom+xml" title="王爵的技术博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.10">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">王爵nice</h5>
          <a href="mailto:biezhi.me@gmail.com" title="biezhi.me@gmail.com" class="mail">biezhi.me@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/projects"  >
                <i class="icon icon-lg icon-cubes"></i>
                项目
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                书籍
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/design"  >
                <i class="icon icon-lg icon-dribbble"></i>
                设计
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/link"  >
                <i class="icon icon-lg icon-link"></i>
                友链
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-leaf"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/biezhi" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">跟上Java8 - Stream API快速入门</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">跟上Java8 - Stream API快速入门</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-07-17T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2017-07-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/跟上Java8/">跟上Java8</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#为什么需要Stream"><span class="post-toc-number">1.</span> <span class="post-toc-text">为什么需要Stream?</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#外部迭代和内部迭代"><span class="post-toc-number">2.</span> <span class="post-toc-text">外部迭代和内部迭代</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用for循环进行迭代"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">使用for循环进行迭代</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用迭代器进行计算"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">使用迭代器进行计算</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用内部迭代进行计算"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">使用内部迭代进行计算</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建Stream"><span class="post-toc-number">3.</span> <span class="post-toc-text">创建Stream</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#流操作"><span class="post-toc-number">4.</span> <span class="post-toc-text">流操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#filter"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">filter</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#map"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">map</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#flatMap"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">flatMap</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#max和min"><span class="post-toc-number">5.</span> <span class="post-toc-text">max和min</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#收集结果"><span class="post-toc-number">6.</span> <span class="post-toc-text">收集结果</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#并行数据处理"><span class="post-toc-number">7.</span> <span class="post-toc-text">并行数据处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#并行和并发"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">并行和并发</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Stream并行流"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">Stream并行流</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-keep-up-with-java8-stream"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">跟上Java8 - Stream API快速入门</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-07-18 00:00:00" datetime="2017-07-17T16:00:00.000Z"  itemprop="datePublished">2017-07-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/跟上Java8/">跟上Java8</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>在前面我们简单介绍了<code>lambda</code>表达式，Java8旨在帮助程序员写出更好的代码，
其对核心类库的改进也是关键的一部分，<code>Stream</code>是Java8种处理集合的抽象概念，
它可以指定你希望对集合的操作，但是执行操作的时间交给具体实现来决定。</p>
<a id="more"></a>
<h2 id="为什么需要Stream"><a href="#为什么需要Stream" class="headerlink" title="为什么需要Stream?"></a>为什么需要Stream?</h2><p>Java语言中集合是使用最多的API，几乎每个Java程序都会用到集合操作，
这里的Stream和IO中的Stream不同，它提供了对集合操作的增强，极大的提高了操作集合对象的便利性。</p>
<p>集合对于大多数编程任务而言都是基本的，为了解释集合是怎么工作，我们想象一下当下最火的外卖APP，
当我们点菜的时候需要按照<strong>距离</strong>、<strong>价格</strong>、<strong>销量</strong>等进行排序后筛选出自己满意的菜品。
你可能想选择距离自己最近的一家店铺点菜，尽管用集合可以完成这件事，但集合的操作远远算不上完美。</p>
<p>假如让你编写上面示例中的代码，你可能会写出如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 店铺属性</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Property</span> </span>&#123;</div><div class="line">    String  name;</div><div class="line">    <span class="comment">// 距离，单位:米</span></div><div class="line">    Integer distance;</div><div class="line">    <span class="comment">// 销量，月售</span></div><div class="line">    Integer sales;</div><div class="line">    <span class="comment">// 价格，这里简单起见就写一个级别代表价格段</span></div><div class="line">    Integer priceLevel;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Property</span><span class="params">(String name, <span class="keyword">int</span> distance, <span class="keyword">int</span> sales, <span class="keyword">int</span> priceLevel)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.distance = distance;</div><div class="line">        <span class="keyword">this</span>.sales = sales;</div><div class="line">        <span class="keyword">this</span>.priceLevel = priceLevel;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// getter setter 省略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我想要筛选距离我最近的店铺，你可能会写下这样的代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    Property p1 = <span class="keyword">new</span> Property(<span class="string">"叫了个鸡"</span>, <span class="number">1000</span>, <span class="number">500</span>, <span class="number">2</span>);</div><div class="line">    Property p2 = <span class="keyword">new</span> Property(<span class="string">"张三丰饺子馆"</span>, <span class="number">2300</span>, <span class="number">1500</span>, <span class="number">3</span>);</div><div class="line">    Property p3 = <span class="keyword">new</span> Property(<span class="string">"永和大王"</span>, <span class="number">580</span>, <span class="number">3000</span>, <span class="number">1</span>);</div><div class="line">    Property p4 = <span class="keyword">new</span> Property(<span class="string">"肯德基"</span>, <span class="number">6000</span>, <span class="number">200</span>, <span class="number">4</span>);</div><div class="line"></div><div class="line">    List&lt;Property&gt; properties = Arrays.asList(p1, p2, p3, p4);</div><div class="line"></div><div class="line">    Collections.sort(properties, (x, y) -&gt; x.distance.compareTo(y.distance));</div><div class="line"></div><div class="line">    String name = properties.get(<span class="number">0</span>).name;</div><div class="line">    System.out.println(<span class="string">"距离我最近的店铺是:"</span> + name);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里也使用了部分<code>lambda</code>表达式，在Java8之前你可能写的更痛苦一些。
要是要处理大量元素又该怎么办呢？为了提高性能，你需要并行处理，并利用多核架构。
但写并行代码比用迭代器还要复杂，而且调试起来也够受的！</p>
<p>但<code>Stream</code>中操作这些东西当然是非常简单的，小试牛刀:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Stream操作</span></div><div class="line">String name2 = properties.stream()</div><div class="line">                .sorted(Comparator.comparingInt(x -&gt; x.distance))</div><div class="line">                .findFirst()</div><div class="line">                .get().name;</div><div class="line">System.out.println(<span class="string">"距离我最近的店铺是:"</span> + name);</div></pre></td></tr></table></figure>
<p>新的API对所有的集合操作都提供了生成流操作的方法，写的代码也行云流水，我们非常简单的就筛选了离我最近的店铺。
在后面我们继续讲解<code>Stream</code>更多的特性和玩法。</p>
<h2 id="外部迭代和内部迭代"><a href="#外部迭代和内部迭代" class="headerlink" title="外部迭代和内部迭代"></a>外部迭代和内部迭代</h2><p>当你处理集合时，通常会对它进行迭代，然后处理返回的每个元素。比如我想看看月销量大于1000的店铺个数。</p>
<h3 id="使用for循环进行迭代"><a href="#使用for循环进行迭代" class="headerlink" title="使用for循环进行迭代"></a>使用for循环进行迭代</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (Property property : properties) &#123;</div><div class="line">    <span class="keyword">if</span>(property.sales &gt; <span class="number">1000</span>)&#123;</div><div class="line">        count++;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的操作是可行的，但是当每次迭代的时候你需要些很多重复的代码。将<code>for</code>循环修改为并行执行也非常困难，
需要修改每个<code>for</code>的实现。</p>
<p>从集合背后的原理来看，<code>for</code>循环封装了迭代的语法糖，首先调用<code>iterator</code>方法，产生一个<code>Iterator</code>对象，
然后控制整个迭代，这就是<strong>外部迭代</strong>。迭代的过程通过调用<code>Iterator</code>对象的<code>hasNext</code>和<code>next</code>方法完成。</p>
<h3 id="使用迭代器进行计算"><a href="#使用迭代器进行计算" class="headerlink" title="使用迭代器进行计算"></a>使用迭代器进行计算</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">Iterator&lt;Property&gt; iterator = properties.iterator();</div><div class="line"><span class="keyword">while</span>(iterator.hasNext())&#123;</div><div class="line">    Property property = iterator.next();</div><div class="line">    <span class="keyword">if</span>(property.sales &gt; <span class="number">1000</span>)&#123;</div><div class="line">        count++;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而迭代器也是有问题的。它很难抽象出<strong>未知的不能操作</strong>；此外它本质上还是串行化的操作，总体来看使用
<code>for</code>循环会将行为和方法混为一谈。</p>
<p>另一种办法是使用内部迭代完成，<code>properties.stream()</code>该方法返回一个<code>Stream</code>而不是迭代器。</p>
<h3 id="使用内部迭代进行计算"><a href="#使用内部迭代进行计算" class="headerlink" title="使用内部迭代进行计算"></a>使用内部迭代进行计算</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">long</span> count2 = properties.stream()</div><div class="line">                .filter(p -&gt; p.sales &gt; <span class="number">1000</span>)</div><div class="line">                .count();</div></pre></td></tr></table></figure>
<p>上述代码是通过<code>Stream API</code>完成的，我们可以把它理解为2个步骤：</p>
<ol>
<li>找出所有销量大于1000的店铺</li>
<li>计算出店铺个数</li>
</ol>
<p>为了找出销量大于1000的店铺，需要先做一次过滤：<code>filter</code>，你可以看看这个方法的入参就是前面讲到的<code>Predicate</code>断言型函数式接口，
测试一个函数完成后，返回值为<code>boolean</code>。
由于<code>Stream API</code>的风格，我们没有改变集合的内容，而是描述了<code>Stream</code>的内容，最终调用<code>count()</code>方法计算出<code>Stream</code>
里包含了多少个过滤之后的对象，返回值为<code>long</code>。</p>
<h2 id="创建Stream"><a href="#创建Stream" class="headerlink" title="创建Stream"></a>创建Stream</h2><p>你已经知道Java8种在<code>Collection</code>接口添加了<code>Stream</code>方法，可以将任何集合转换成一个<code>Stream</code>。
如果你操作的是一个数组可以使用<code>Stream.of(1, 2, 3)</code>方法将它转换为一个流。</p>
<p>也许有人知道JDK7中添加了一些类库如<code>Files.readAllLines(Paths.get(&quot;/home/biezhi/a.txt&quot;))</code>这样的读取文件行方法。
<code>List</code>作为<code>Collection</code>的子类拥有转换流的方法，那么我们读取这个文本文件到一个字符串变量中将变得更简洁：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">String content = Files.readAllLines(Paths.get(<span class="string">"/home/biezhi/a.txt"</span>)).stream()</div><div class="line">            .collect(Collectors.joining(<span class="string">"\n"</span>));</div></pre></td></tr></table></figure>
<p>这里的<code>collect</code>是后面要讲解的<strong>收集器</strong>，对<code>Stream</code>进行了处理后得到一个文本文件的内容。</p>
<p>JDK8也为我们提供了一些便捷的<code>Stream</code>相关类库:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/static/img/article/java8-stream-class.png" alt="java8提供的Stream类库" width="320" height="500" title="">
                </div>
                <div class="image-caption">java8提供的Stream类库</div>
            </figure>
<p>创建一个流是很简单的，下面我们试试用创建好的<code>Stream</code>做一些操作吧。</p>
<h2 id="流操作"><a href="#流操作" class="headerlink" title="流操作"></a>流操作</h2><p><code>java.util.stream.Stream</code>中定义了许多流操作的方法，为了更好的理解<code>Stream API</code>掌握它常用的操作非常重要。
流的操作其实可以分为两类：<strong>处理操作</strong>、<strong>聚合操作</strong>。</p>
<ul>
<li>处理操作：诸如<code>filter</code>、<code>map</code>等处理操作将<code>Stream</code>一层一层的进行抽离，返回一个流给下一层使用。</li>
<li>聚合操作：从最后一次流中生成一个结果给调用方，<code>foreach</code>只做处理不做返回。</li>
</ul>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p><code>filter</code>看名字也知道是过滤的意思，我们通常在筛选数据的时候用到，频率非常高。
<code>filter</code>方法的参数是<code>Predicate&lt;T&gt; predicate</code>即一个从<code>T</code>到boolean的函数。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/static/img/article/java8-filter.png" alt="" width="300" height="200" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p><strong>筛选出距离我在1000米内的店铺</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">properties.stream()</div><div class="line">            .filter(p -&gt; p.distance &lt; <span class="number">1000</span>)</div></pre></td></tr></table></figure>
<p><strong>筛选出名称大于5个字的店铺</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">properties.stream()</div><div class="line">            .filter(p -&gt; p.name.length() &gt; <span class="number">5</span>);</div></pre></td></tr></table></figure>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>有时候我们需要将流中处理的数据类型进行转换，这时候就可以使用<code>map</code>方法来完成，将流中的值转换为一个新的流。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/static/img/article/java8-map.png" alt="" width="300" height="200" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p><strong>列出所有店铺的名称</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">properties.stream()</div><div class="line">            .map(p -&gt; p.name);</div></pre></td></tr></table></figure>
<p>传给<code>map</code>的<code>lambda</code>表达式接收一个<code>Property</code>类型的参数，返回一个<code>String</code>。
参数和返回值不必属于同一种类型，但是<code>lambda</code>表达式必须是<code>Function</code>接口的一个实例。</p>
<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><p>有时候我们会遇到提取子流的操作，这种情况用的不多但是遇到<code>flatMap</code>将变得更容易处理。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/static/img/article/java8-flatmap.png" alt="" width="300" height="200" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>例如我们有一个<code>List&lt;List&lt;String&gt;&gt;</code>结构的数据：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">List&lt;List&lt;String&gt;&gt; lists = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        lists.add(Arrays.asList(<span class="string">"apple"</span>, <span class="string">"click"</span>));</div><div class="line">        lists.add(Arrays.asList(<span class="string">"boss"</span>, <span class="string">"dig"</span>, <span class="string">"qq"</span>, <span class="string">"vivo"</span>));</div><div class="line">        lists.add(Arrays.asList(<span class="string">"c#"</span>, <span class="string">"biezhi"</span>));</div></pre></td></tr></table></figure>
<p>要做的操作是获取这些数据中长度大于2的单词个数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">lists.stream()</div><div class="line">        .flatMap(Collection::stream)</div><div class="line">        .filter(str -&gt; str.length() &gt; <span class="number">2</span>)</div><div class="line">        .count();</div></pre></td></tr></table></figure>
<p>在不使用<code>flatMap</code>前你可能需要做2次<code>for</code>循环。这里调用了<code>List</code>的<code>stream</code>方法将每个列表转换成<code>Stream</code>对象，
其他的就和之前的操作一样。</p>
<h2 id="max和min"><a href="#max和min" class="headerlink" title="max和min"></a>max和min</h2><p><code>Stream</code>中常用的操作之一是求最大值和最小值，<code>Stream API</code> 中的<code>max</code>和<code>min</code>操作足以解决这一问题。</p>
<p>我们需要筛选出价格最低的店铺:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Property property = properties.stream()</div><div class="line">            .max(Comparator.comparingInt(p -&gt; p.priceLevel))</div><div class="line">            .get();</div></pre></td></tr></table></figure>
<p>查找<code>Stream</code>中的最大或最小元素，首先要考虑的是用什么作为排序的指标。
以查找价格最低的店铺为例，排序的指标就是<strong>店铺的价格等级</strong>。</p>
<p>为了让<code>Stream</code>对象按照价格等级进行排序，需要传给它一个<code>Comparator</code>对象。
Java8提供了一个新的静态方法<code>comparingInt</code>，使用它可以方便地实现一个比较器。
放在以前，我们需要比较两个对象的某项属性的值，现在只需要提供一个存取方法就够了。</p>
<h2 id="收集结果"><a href="#收集结果" class="headerlink" title="收集结果"></a>收集结果</h2><p>通常我们处理完流之后想查看一下结果，比如获取总数，转换结果，在前面的示例中你发现调用了
<code>filter</code>、<code>map</code>之后没有下文了，后续的操作应该调用<code>Stream</code>中的<code>collect</code>方法完成。</p>
<p><strong>获取距离我最近的2个店铺</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">List&lt;Property&gt; properties = properties.stream()</div><div class="line">            .sorted(Comparator.comparingInt(x -&gt; x.distance))</div><div class="line">            .limit(<span class="number">2</span>)</div><div class="line">            .collect(Collectors.toList());</div></pre></td></tr></table></figure>
<p><strong>获取所有店铺的名称</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">List&lt;String&gt; names = properties.stream()</div><div class="line">                      .map(p -&gt; p.name)</div><div class="line">                      .collect(Collectors.toList());</div></pre></td></tr></table></figure>
<p><strong>获取每个店铺的价格等级</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Map&lt;String, Integer&gt; map = properties.stream()</div><div class="line">        .collect(Collectors.toMap(Property::getName, Property::getPriceLevel));</div></pre></td></tr></table></figure>
<p><strong>所有价格等级的店铺列表</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Map&lt;Integer, List&lt;Property&gt;&gt; priceMap = properties.stream()</div><div class="line">                .collect(Collectors.groupingBy(Property::getPriceLevel));</div></pre></td></tr></table></figure>
<h2 id="并行数据处理"><a href="#并行数据处理" class="headerlink" title="并行数据处理"></a>并行数据处理</h2><h3 id="并行和并发"><a href="#并行和并发" class="headerlink" title="并行和并发"></a>并行和并发</h3><p>并发是两个任务共享时间段，并行则是两个任务在同一时间发生，比如运行在多核CPU上。
如果一个程序要运行两个任务，并且只有一个CPU给它们分配了不同的时间片，那么这就是并发，而不是并行。</p>
<blockquote>
<p>并行化是指为缩短任务执行时间，将一个任务分解成几部分，然后并行执行。</p>
</blockquote>
<p>这和顺序执行的任务量是一样的，区别就像用更多的马来拉车，花费的时间自然减少了。
实际上，和顺序执行相比，并行化执行任务时，CPU承载的工作量更大。</p>
<blockquote>
<p>数据并行化是指将数据分成块，为每块数据分配单独的处理单元。</p>
</blockquote>
<p>还是拿马拉车那个例子打比方，就像从车里取出一些货物，放到另一辆车上，两辆马车都沿着同样的路径到达目的地。</p>
<p>当需要在大量数据上执行同样的操作时，数据并行化很管用。
它将问题分解为可在多块数据上求解的形式，然后对每块数据执行运算，最后将各数据块上得到的结果汇总，从而获得最终答案。</p>
<p>人们经常拿任务并行化和数据并行化做比较，在任务并行化中，线程不同，工作各异。
我们最常遇到的JavaEE应用容器便是任务并行化的例子之一，每个线程不光可以为不同用户服务，
还可以为同一个用户执行不同的任务，比如登录或往购物车添加商品。</p>
<h3 id="Stream并行流"><a href="#Stream并行流" class="headerlink" title="Stream并行流"></a>Stream并行流</h3><p>流使得计算变得容易，它的操作也非常简单，但你需要遵守一些约定。默认情况下我们使用集合的<code>stream</code>方法
创建的是一个串行流，你有两种办法让他变成并行流。</p>
<ol>
<li>调用<code>Stream</code>对象的<code>parallel</code>方法</li>
<li>创建流的时候调用<code>parallelStream</code>而不是<code>stream</code>方法</li>
</ol>
<p>我们来用具体的例子来解释串行和并行流</p>
<p><strong>串行化计算</strong></p>
<p>筛选出价格等级小于4，按照距离排序的2个店铺名</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">properties.stream()</div><div class="line">            .filter(p -&gt; p.priceLevel &lt; <span class="number">4</span>)</div><div class="line">            .sorted(Comparator.comparingInt(Property::getDistance))</div><div class="line">            .map(Property::getName)</div><div class="line">            .limit(<span class="number">2</span>)</div><div class="line">            .collect(Collectors.toList());</div></pre></td></tr></table></figure>
<p>调用 parallelStream 方法即能并行处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">properties.parallelStream()</div><div class="line">            .filter(p -&gt; p.priceLevel &lt; <span class="number">4</span>)</div><div class="line">            .sorted(Comparator.comparingInt(Property::getDistance))</div><div class="line">            .map(Property::getName)</div><div class="line">            .limit(<span class="number">2</span>)</div><div class="line">            .collect(Collectors.toList());</div></pre></td></tr></table></figure>
<p>读到这里，大家的第一反应可能是立即将手头代码中的<code>stream</code>方法替换为<code>parallelStream</code>方法，
因为这样做简直太简单了！先别忙，为了将硬件物尽其用，利用好并行化非常重要，但流类库提供的数据并行化只是其中的一种形式。</p>
<p>我们先要问自己一个问题：<code>并行化运行基于流的代码是否比串行化运行更快？</code>这不是一个简单的问题。
回到前面的例子，哪种方式花的时间更多取决于串行或并行化运行时的环境。</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        

        
        原创文章，转载请注明： 转载自<a href="http://biezhi.me" target="_blank">王爵的技术博客</a><br/>本文链接地址：<a href="/2017/07/18/keep-up-with-java8-stream.html" target="_blank" rel="external">http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html</a>
        
    </div>
    <footer>
        <a href="http://biezhi.me">
            <img src="/img/avatar.png" alt="王爵nice">
            王爵nice
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java8/">Java8</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/collect/">collect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/filter/">filter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flatmap/">flatmap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stream/">stream</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html&title=《跟上Java8 - Stream API快速入门》 — 王爵的技术博客&pic=http://biezhi.me/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html&title=《跟上Java8 - Stream API快速入门》 — 王爵的技术博客&source=在前面我们简单介绍了lambda表达式，Java8旨在帮助程序员写出更好的代码，
其对核心类库的改进也是关键的一部分，Stream是Java8种处理集合的..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《跟上Java8 - Stream API快速入门》 — 王爵的技术博客&url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html&via=http://biezhi.me" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/07/19/keep-up-with-java8-functional-programming.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">跟上Java8 - 函数式编程</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/07/17/keep-up-with-java8-lambda.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">跟上Java8 - 了解lambda</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'biezhi';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>













</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢支持 :)
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>王爵nice &copy; 2017</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html&title=《跟上Java8 - Stream API快速入门》 — 王爵的技术博客&pic=http://biezhi.me/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html&title=《跟上Java8 - Stream API快速入门》 — 王爵的技术博客&source=在前面我们简单介绍了lambda表达式，Java8旨在帮助程序员写出更好的代码，
其对核心类库的改进也是关键的一部分，Stream是Java8种处理集合的..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《跟上Java8 - Stream API快速入门》 — 王爵的技术博客&url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html&via=http://biezhi.me" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://biezhi.me/2017/07/18/keep-up-with-java8-stream.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3aS27DMAwFwN7/0u4BCiuPlFPA1GhlpImt8YLlRz8/8bpu1vqb67v9vb775LGFgYHxWsa1XHffyR+c/DZ/7u1rwsDAOIDxVFgsPDh4VrI3DAwMjIRxFyh7KSYGBgbGtxnJJtb3xMDAwNgpYqsFar7F9fXDtTgGBsYLGXnX/f+vvzLfwMDAeBXjKq4ksdsJ5VdrYWBgzGbkAW49XKyWqfsBFwMD4zRGtbG1H6CToxX5y8LAwDiBkQe4ZhBc/jX//EMyioGBcTAjacdXm/75J4XUEwMDYzQj2XQS+JK2Wq/1Vg39GBgY8xj5Ftcb6pXHXyliMTAwhjL2E8Rq4K628KIMFwMDYyijt/Vq4ZqPH/ZbexgYGJMYeUpXnYjmg8yo6b9zWgQDA+PljDzU7jN6hy2qSAwMjHmMXnGYjxt7Gy2PQjEwMEYzkkZ/0rh/ttHfO96BgYExlbHVcG+lhs03vUZiYGCMZvSK2Gqp2Rt89kahGBgYUxnVwjJvyVXL3a3hAQYGxgGMZIu90WMv6ud7wMDAOI3RS+PyOzx1gAMDA+McxlVcvXbYftL5IUxjYGCMZvQa/dXb7bTtqmkoBgbGVEa1cZa30vIRQi/gYmBgnMZICs6dQWO1bbdGYmBgYFTTsvzIVzXsFn6FgYGBEY8qeyPJ6p1vxwMYGBijGdVhQLUplo8Tqi08DAyMExi90rE6mKwetuj9G8DAwBjH+AUSklWDnb70BwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.10"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.10" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
